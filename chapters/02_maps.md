---
jupytext:
  text_representation:
    extension: .md
    format_name: myst
    format_version: 0.13
    jupytext_version: 1.11.5
kernelspec:
  display_name: Python 3
  language: python
  name: python3
---

# خلق الخارطة التفاعليه Interactive Map

```{contents}
:local:
:depth: 2
```

## 1. مدخل إلى الخارطة التفاعلية:
بعد تمثيل البيانات المكانية  واحدة من اهم مميزات البرامج و التطبيقات الكفؤة, و يعرف تمثيل البيانات على أنه ترجمة المعلومات الرقمية و النصية إلى أشكال تمكن العقل البشري من فهما بسهولة و يسر و لاستخراج الأفكار و النماذج المشتركة. هناك الكثير من الصيغ التي يكمن من خلالها تمثيل البيانات منا المخططات, الرسوم البيانية, و الخرائط. و هناك الكثير من المميزات التي يجب يتمتع بها التمثيل للبيانات في الصيغة المطلوبة. حيث يجب أن تكون الصيغة التي مُثلت بها البيانات بسيطة و سهلة خاليه من التعقيد, و أن تطابق نوع البيانات, و أن تكون لها القابلية توضيح النقاط الجوهرية التي يهدف إليها المصمم. و على الرغم من وجود الكثير من البرامج و التطبيقات التي تساعد على تمثيل البيانات المكانية إلا أنها تعد مهمه ليست بالسهلة إلى حد ما, لما تحتويه من عناصر رقمية يجب إسقاطها طبقة التمثيل بدقة و التي تمثل موقع تلك المعلومات على سطح الأرض. 

تعتبر الخرائط من أهم الصيغ التي يحتاجها العاملون في مجال نظم المعلومات الجغرافية و الاستشعار عن بعد و كذلك بقية الحقول المعرفية لتمثيل البيانات و تحديد موقع الظواهر في موقعها الحقيقي. تمثل الخرائط طريقة سهله لتمثيل البيانات الرقمية التي تحمل إحداثيات مطابقة للواقع المكاني و تمكن من تصديرها على شكل صور, PDF, KML, أو غيرها من الصيغ, و يسمى هذا النوع من الخرائط بالخرائط الثابتة (static maps). على الرغم من ذلك هناك بعض محددات في إصدار خرائط  باستخدام الخرائط الثابتة بشكل يتلائم مع الغرض أحيانا. من هذه المحددات منها عدم إمكانية تحديد مساحات كبيره, و لا يمكن إظهار ديناميكية التفاعل مع صيغة البيانات مثل تتبع التغيرات عبر الزمن أو الارتباطات. و المهم أنها لا تستطيع إظهار مستويات مختلفة من البيانات. و من الخلال الخرائط الثابتة لا يستطيع المستخدم من تخصيص أو فلترة البيانات حسب احتياجه و بشكل ديناميكي. و لا يمكن خلالها التركيز على القيم المتطرفة أو الشذوذ أو تحديد القيم الغير واضحة.

و لأجل معالجة جميع هذه المشاكل تم طرح الخارطة التفاعلية و كذلك ربطها بقاعدة ضخمة من البيانات و التي تكون جاهزة للمستخدم مما يتيح بناء تطبيق و استخدامها و اكتشاف حقول جديدة من خلال أتاحتها إلى جميع الباحثين حول العالم. 
الخارطة التفاعلية هي تطبيق يسمح باستعراض البيانات على متصفح الويب. تمكن الخارطة التفاعلية المستخدم من تمثيل البيانات على شكل طبقات يستطيع المستخدم تخصيصها و إدارتها بشكل مرن. من خلال الخارطة التفاعلية من زيادة و تصغير حجم مساحة التمثيل مما يتيح له الكشف عن العناصر المشتركة و الأنماط و قياس تأثير الظواهر في مديات مختلفة. أضافة الى ذلك أمكانية أضافة تطبيقات مباشرة على البيانات  من خلال بعض النوافذ و التلميحات و التي تعتبر أدوات إضافية يتحكم بها المستخدم.

هناك الكثير من المميزات التي تجعل من الخارطة التفاعلية أكثر استخداما من غيرها منها:

•	المشاركة مع المستخدمين: عند العمل كفريق في مشروع ما فأن الخارطة التفاعلية تتيح للمستخدم أمكانية المشاركة مع الفريق و بالتالي تكامل إخراج المشروع و البيانات من قبل أكثر من وجه نظر.
•	تغيير حجم الخارطة مساحة أنتشار البيانات في مستويات متعددة على الشاشة.
•	تصوير البيانات على شكل طبقات قابلة للتعديل على الشاشة و التي تمثل أحيانا البيانات لفترات زمنية مختلفة مما يتيح تتبع التغيرات عبر الزمن.



## 2. المتطلبات التقنية
كما اسلفنا في الفصل الأول فان العمل على الخارطة التفاعلية يحتاج إلى بعض من المكتب التي يجب ان يتم استيرادها للعمل على البيانات المكانية. و تتطلب هذه المكتبات  بعض أدارة لبيئة conda و تثبيت بعض الحزم الضرورية و طلب تصريح العمل على بيانات Google Earth Engine. و يأتي ملخص الخطوات التقنية التي تسبق العمل على الخارطة التفاعلية بما يلي:

```bash
conda create -n gee python
conda activate gee
conda install -c conda-forge mamba
mamba install -c conda-forge pygis
```

```bash
jupyter lab
```

```{code-cell} ipython3
# %pip install pygis
```

```{code-cell} ipython3
import ee
import geemap
```

```{code-cell} ipython3
geemap.ee_initialize()
```

## 3. رسم القاعدة الخلفية (Plotting back-ends)

يتطلب رسم الخرائط إنشاء القاعدة الأساسية التي سوف يتم رسم الخارطة الأساس عليها و التي تحتوي على دوال تقوم بعملية إسقاط المعلومات في موقعها الحقيقي على السطح بشكل رقمي على الخارطة يتناسب حسب مقياس الرسم المعتمد. و التي تمكن المستخدم من تمثيل البيانات المكانية  بسهوله و يسر. هناك العديد من المكتبات التي تساعد في عمل الهيكل الأساس الذي يستعمل في **geemap**
### 3.1 رسم قاعدة خلفية بأستخدام	Ipyleaflet

 

```{code-cell} ipython3
import geemap
```

```{code-cell} ipython3
Map = geemap.Map()  # الطريقة الاعتيادية و التي تأخذ المدخلات الافتراضية
```

```{code-cell} ipython3
Map
```

```{code-cell} ipython3
Map = geemap.Map(center=[40, -100], zoom=4, height=600)  #تحديد حجم و ارتفاع الخارطة و مرك أو إحداثي المنطقة المراد استعراضها
Map
```

```{code-cell} ipython3
Map = geemap.Map(data_ctrl=False, toolbar_ctrl=False, draw_ctrl=False) #في حالة إضافة أشرطة الأدوات الخاصة بالبيانات و تغيير المساحة إلى الخارطة 
Map
```

```{code-cell} ipython3
Map = geemap.Map(lite_mode=True)
Map
```

```{code-cell} ipython3
Map.save('ipyleaflet.html')
```

### 3.2 رسم قاعدة خلفية بأستخدام Foluim
استخدام مكتبة **folium** مع الإعدادات الافتراضية و تحديد إحداثيات المركز و المساحة و المدى للخارطة. و تلاحظ أنها تختلف عن Ipyleaflet في عدد الأدوات المتاحة و كذلك محدودية البحث عن موقع معين.



```{code-cell} ipython3
import geemap.foliumap as geemap
Map = geemap.Map(center=[40, -100], zoom=4, height=600) 
Map
```

```{code-cell} ipython3
Map.save('folium.html')
```

### 3.3 رسم قاعدة خلفية بأستخدام Plotly
تلاحظ أن **plotly** تتيح للمستخدم إمكانية رسم مخطط للبيانات للمنطقة المحددة و ضمن الطبقة المطلوبة, كذلك المباشرة بعملية تحميل المخطط 

```{code-cell} ipython3
import geemap.plotlymap as geemap
```

```{code-cell} ipython3
Map = geemap.Map()
Map
```

```{code-cell} ipython3
# geemap.fix_widget_error()
```

### 3.4 رسم قاعدة خلفية بأستخدام Pydeck
تقوم pydeck باستعراض الطبقات على الخارطة الأساس CARTO, OpenStreetMap contributors.  


```{code-cell} ipython3
import geemap.deck as geemap
Map = geemap.Map()
Map
```

مع ملاحظه أنها تحتاج إلى تنصيب في بعض الأحيان و لأجل ذلك يجب أن تنفذ الإيعاز التالي:
```{code-cell} ipython3
!pip install pydeck
```

### 3.5 رسم قاعدة خلفية بأستخدام KeplerGL
على الرغم من أن kepler ملحقة بـgeemap إلا إنها تحتاج إلى تنصيب مستقل و لأجل ذلك قم بتنفيذ الإيعاز الأخير.
```{code-cell} ipython3
import geemap.kepler as geemap
Map = geemap.Map()
Map
```
```{code-cell} ipython3
!pip install kepler
```
## 4.	إضافة الخارطة الأساس basemap
الخارطة الأساس هي طبقة من المعلومات الجغرافية التي تعتبر أرضية متكونة من سياق يقوم بأسقاط البيانات المكانية إعتماداً على إشارات مرجعية مكانية لسمات ثابتة لا تتغير مثل الأنهار, الحدود, و الطرق, و غيرها. و تصنف الخرائط الأساس إلى خمس أنواع و التي يمكن إدراجها و حسب الإيعازات المشار إليها أدناه في كل نقطة.


### 4.1 أضافة خرائط اساس نوع Built-in
هناك حوالي 411  نوع من الخرائط الأساس التي تعتبر ضمنيه في **geemap** و الشائع منها هي  **OpenStreetMap, **ROADMAP**, **SATELLITE**, **TERRAIN**, **HYBRID**.  


```{code-cell} ipython3
import geemap

Map = geemap.Map(basemap='HYBRID') # HYBRID   إدراج خارطة أساس 
Map
```
في حال تغيير نوع الخارطة الأساس و في هذا المثال تم تغيير الخراطة الأساس إلى OpenTopoMap
```{code-cell} ipython3
Map.add_basemap('OpenTopoMap')
```
و لغرض طباعة أسماء خرائط الأساس (built-in basemaps) الموجودة ضمن    **geemap**
```{code-cell} ipython3
for basemap in geemap.basemaps.keys():
    print(basemap)
```

لأجل معرفة عدد الخرائط الأساس في **geemap** بعد التحديث قم بتنفيذ الإيعاز التالي:
```{code-cell} ipython3
len(geemap.basemaps)
```


### 4.2 إضافة الخارطة الأساس XYZ tiles
هناك نوع من الخرائط الأساس لا يوجد في ضمن geemap بل يتم استيراده من مصدر خارجي و هو عباره عن برتوكول يقوم بعملية إرجاع جغرافي لتشكيلات ثابته يتم تحديدها من قبل المستخدم. تعتبر XYZ tiles واحدة من هذه الأنواع و التي يتم تحميلها من رابط معين و تضاف كطبقة إلى القاعدة الخلفية. في الخطوات التالية يتم إضافة الخارطة الأساس XYZ tiles إلى الخارطة.

```{code-cell} ipython3
Map = geemap.Map()
Map.add_tile_layer(
    url="https://mt1.google.com/vt/lyrs=p&x={x}&y={y}&z={z}",
    name="Google Terrain",
    attribution="Google",
)
Map
```

###  4.3 إضافة الخارطة الأساس WMS tiles
تزود هذه الخارطة من قبل المجموعة الاتحادية استخراج خصائص الأرض من صور عالية الدقة, و التي هي عباره عن جمعية مشـــتركه لأكثر من دوله وظيفتها تحليل الغطاء الأرضــــي على مســــــتوى العالم (Global Scale). للمزيد الرابط التالي         [Multi-Resolution Land Characteristics (MRLC) Consortium](https://www.mrlc.gov/).
قم بتنفيذ الخطوات التالية لأجل استيراد خارطة أساس WMS tiles:


```{code-cell} ipython3
Map = geemap.Map(center=[40, -100], zoom=4)
url = 'https://www.mrlc.gov/geoserver/mrlc_display/NLCD_2019_Land_Cover_L48/wms?'
Map.add_wms_layer(
    url=url,
    layers='NLCD_2019_Land_Cover_L48',
    name='NLCD 2019',
    format='image/png',
    attribution='MRLC',
    transparent=True,
)
Map
```

### 4.4 إضافة الخارطة الأساس Planet basemaps

تعتبر Planet Basemaps واحدة من اهم الخرائط الأساس التي تزود التغيرات في الغطاء النباتي على مدار السنه منذ العام 2016 . لقد قام فريق من المطورين متخصص في مجال نظم المعلومات الجغرافية ببناء هذه الخارطة الأساس و بالاستفادة من البرامج المتطورة التي تعمل على دمج صور الأقمار الصناعية على مستوى العالم و استخلاص الموزاييك الأرضي و على مديات زمنيه تتقارب لفترات ثلاثة هي شهريه, ربع سنوية, و سنوية. تزود Planet basemaps المستخدمين بالقدرة على الحصول على رؤية دقيقه لمساحات واسعة و كذلك التحليل الزمني لفترات معينه مما يتيح إمكانيه تتبع التغيرات و التنبؤ بمستقبل التنوع السطحي للبيئة.
`ملاحظه: لأجل استخدام Planet basemaps يجب عليك تغيير مفتاح بيئة العمل و الذي يكون ضمن نظام التشغيل الخاص بـ conda.`

```{code-cell} ipython3
import os

os.environ["PLANET_API_KEY"] = "YOUR_API_KEY"  #  هنا يمكن تغير مفتاح الدخول الى بيئة العمل على الخارطة الاساس
```

```{code-cell} ipython3
quarterly_tiles = geemap.planet_quarterly_tiles()   # هذه الخطوات تمكن من استعراض البيانات للقواعد الأساس حسب الربع السنوي
for tile in quarterly_tiles:
    print(tile)
```

```{code-cell} ipython3
monthly_tiles = geemap.planet_monthly_tiles()  #  هذه الخطوات تمكن من استعراض البيانات للقواعد الأساس شهريا
for tile in monthly_tiles:
    print(tile)
```

```{code-cell} ipython3
Map = geemap.Map()
Map.add_planet_by_month(year=2020, month=8)  # لأجل إضافة خارطة أساس على المدى الشهري و المحدد للشهر الثامن لعام 2020 كما في هذا المثال
Map
```

```{code-cell} ipython3
Map = geemap.Map()
Map.add_planet_by_quarter(year=2019, quarter=2)  # لأجل إضافة خارطة أساس على المدى الربع سنوي و المحدد لربع السنه الثاني لعام  2019 كما في هذا المثال
Map
```

### 4.5 إضافة الخارطة الأساس Basemap GUI

```{code-cell} ipython3
import os

os.environ["PLANET_API_KEY"] = "YOUR_API_KEY"  # تغيير المفتاح
```

```{code-cell} ipython3
Map = geemap.Map()  # أضافة الخارطه
Map
```

## الخلاصة
الخارطة التفاعلية هي تطبيق يسمح باستعراض البيانات على متصفح الويب. لاجل خلق خارطة تفاعليه هناك عدد من المتطلبات التقنية التي يجب تحضيرها للعمل. و كذلك يجب تحديد نوع القاعدة الخلفية التي سوف يتم رسم الخارطه الاساس عليها و كذلك بقية الطبقات للبيانات المكانية. تحتوي القاعده الخلفيه على عدد من الادوات و التلميحات التي تمكن المستخدم من العمل بشكل مباشر على استخدام تطبيقات جاهزه تجعل من العمل مرن و سهل في التبادل مع الواجهة و مصدر البيانات. و جميع ما تم تنفيذه في الفصل هذا هو واجهه للخارطة التفاعلية. 
